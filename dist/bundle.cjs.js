"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var _=_interopDefault(require("lodash")),path=_interopDefault(require("path")),filePathOneLayer=_interopDefault(require("file-path-one-layer"));function lift(){let e=this.policies={},i=this.config.paths.policies=path.join(this.projectPath,"policies");return filePathOneLayer(i).then(i=>{i.forEach(i=>{let t=require(i.path);e[i.name]=t.default?t.default:t})}).then(()=>{this.config.controllerActionPolicies={},this.config.policies=this.config.policies||{};let e=this.config.policies["*"]||[];_.forEach(this.controllers,(i,t)=>{let o=this.config.policies[t]||{},l=o["*"]||e;_.forEach(i,(e,i)=>{_.isFunction(e)&&(this.config.controllerActionPolicies[`${t}.${i}`]=o[i]||l)})});let i=[];return this.controllerActionPolicies=_.mapValues(this.config.controllerActionPolicies,e=>_.map(e,e=>{let t=this.policies[e];return t||i.push(e),t})),i.length?Promise.reject(new Error(`Unknown policy:${i.join(",")}`)):Promise.resolve()})}module.exports=lift;
//# sourceMappingURL=bundle.cjs.js.map
