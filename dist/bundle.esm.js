import _ from"lodash";import path from"path";import filePathOneLayer from"file-path-one-layer";function lift(){let i=this.policies={},o=this.config.paths.policies=path.join(this.projectPath,"policies");return filePathOneLayer(o).then(o=>{o.forEach(o=>{let t=require(o.path);i[o.name]=t.default?t.default:t})}).then(()=>{this.config.controllerActionPolicies={},this.config.policies=this.config.policies||{};let i=this.config.policies["*"]||[];_.forEach(this.controllers,(o,t)=>{let e=this.config.policies[t]||{},l=e["*"]||i;_.forEach(o,(i,o)=>{_.isFunction(i)&&(this.config.controllerActionPolicies[`${t}.${o}`]=e[o]||l)})});let o=[];return this.controllerActionPolicies=_.mapValues(this.config.controllerActionPolicies,i=>_.map(i,i=>{let t=this.policies[i];return t||o.push(i),t})),o.length?Promise.reject(new Error(`Unknown policy:${o.join(",")}`)):Promise.resolve()})}module.exports=lift;
//# sourceMappingURL=bundle.esm.js.map
